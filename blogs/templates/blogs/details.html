<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>{{ blog.title }}</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
</head>

<body class="bg-light">

<div class="container mt-4">

    <div class="card shadow-sm mb-4">
        <div class="card-body">
            <h2>{{ blog.title }}</h2>
            <p>{{ blog.content }}</p>

            <!-- SHOW EDIT BUTTON ONLY IF OWNER -->
            {% if request.user == blog.user %}
                <a href="{% url 'edit' blog.id %}" class="btn btn-warning">Edit Blog</a>
            {% endif %}
            <br><br>

            <!-- REVIEW FORM -->
            <h3>Write a Review</h3>

            {% if can_review %}
                <form method="POST">
                    {% csrf_token %}
                    <select name="rating" class="form-control mb-3" required>
                        <option value="">Select Rating</option>
                        <option value="1">1 - Poor</option>
                        <option value="2">2 - Average</option>
                        <option value="3">3 - Good</option>
                        <option value="4">4 - Very Good</option>
                        <option value="5">5 - Excellent</option>
                    </select>

                    <textarea name="comment" class="form-control mb-3" rows="3" placeholder="Write your review..." required></textarea>
                    <button class="btn btn-primary">Submit Review</button>
                </form>
            {% else %}
                <div class="alert alert-info">You cannot review your own blog.</div>
            {% endif %}
        </div>
    </div>

    <!-- REVIEWS SECTION -->
    <h4>Reviews</h4>

    {% for r in reviews %}
        <div class="card mb-3">
            <div class="card-body">

                <p><b>{{ r.reviewer.username }}</b> rated <b>{{ r.rating }}/5</b></p>
                <p>{{ r.comment }}</p>

                {% if r.reply %}
                    <div class="alert alert-secondary mt-2">
                        <b>Owner Reply:</b> {{ r.reply.reply_text }}
                    </div>
                {% else %}
                    <!-- ONLY OWNER CAN REPLY -->
                    {% if request.user == blog.user %}
                        <a href="{% url 'review' r.id %}" class="btn btn-sm btn-info">Reply</a>
                    {% endif %}
                {% endif %}

            </div>
        </div>
    {% empty %}
        <p>No reviews yet.</p>
    {% endfor %}

</div>

</body>
</html>
